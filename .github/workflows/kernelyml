name: Compile Linux Kernel

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential libncurses-dev bison flex libssl-dev

    - name: Download Linux Kernel source
      run: git clone https://github.com/commaai/android_kernel_comma_msm8996.git
          
    - name: Change directory to kernel source
      run: cd android_kernel_comma_msm8996

    - name: Configure Kernel
      run: |
        make ARCH=arm64 defconfig
        # You can customize the kernel configuration here if needed

    - name: Compile Kernel
      run: make ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu- -j$(nproc)

    - name: Package Kernel
      run: |
        mkdir -p ${HOME}/kernel
        cp arch/arm64/boot/Image ${HOME}/kernel/
        cp arch/arm64/boot/dts/*.dtb ${HOME}/kernel/

    - name: Upload Artifacts
      uses: actions/upload-artifact@v2
      with:
        name: kernel-artifacts
        path: ${{HOME}}/kernel

